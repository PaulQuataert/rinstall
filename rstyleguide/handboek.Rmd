---
title: "Kwaliteitshandboek voor R code"
author: "Thierry Onkelinx en Pieter Verschelde"
date: "Thursday, February 12, 2015"
bibliography: "~/local_tex/bibtex/bib/kwaliteitshandboek.bib"
output: pdf_document
---

# Inleiding

Doel van dit kwaliteitshandboek is het vastleggen van minimumeisen voor R gerelateerde code. Deze dienen te worden nageleefd in het geval van generieke R projecten die door meerdere mensen worden onderhouden. Het is aanbevolen om dit kwaliteitshandboek ook in andere omstandigheden steeds te volgen.

Het kwaliteitshandboek is gebaseerd op @Boswell2011, @Baath2012, @Baath2012, @Wickham2014 en @Ano2015.

# Naamgeving

Zorg er voor dat de naam reeds een goed beeld geeft van de inhoud. Vermijdt namen zonder betekenis als `tmp`. Probeer namen zo concreet mogelijk te maken. `data` is prima als naam voor een dataset in een generieke functie. `boom` is een betere naam als het gaat over een dataset met gegevens van verschillende bomen. Indien de eenheden van belang zijn, kan je ze best in de naam van de variabelen verwerken. Vergelijk `volume <- function(omtrek, hoogte)` met `werkhout_volume_m3 <- function(omtrek.cm, hoogte.m)`

Maak een goede afweging tussen een lange naam met die veel informatie bevat en een korte naam. Een korte naam is ok als iemand anders de naam ondubbelzinnig kan interpreteren. Vermijdt namen met een ambigue betekenis. Gebruik `TRUE` en `FALSE` steeds voluit. Voor toewijzingen gebruiken we enkel `<-`. Voor het doorgeven van argumenten aan een functie enkel `=`.

## Formatering van namen

functie
  ~ underscore separated lowercase
  ~ allemaal kleine letters, underscore (`_`) om woorden te scheiden
  ~ `mean()`, `werkhout_volume_m3()`
object
  ~ point separated lowercase
  ~ allemaal kleine letters, woorden worden door punten gescheiden
  ~ `boom`, `omtrek.cm`
variabele
  ~ kolomnamen in matrices en dataframes, namen in lijsten en vectoren
  ~ upper camelcase
  ~ eerste letter van elk woord in hoofdletters, de rest in kleine letters
  ~ `Aantal`, `SoortNl`, `OmtrekCm`, `HoogteM`
bestandsnaam script met functie
  ~ extensie `.R`
  ~ identiek aan de naam van de (hoofd)functie indien het script de defintie van een functie bevat
overige bestandsnamen
  ~ naam die een beknopte concrete beschrijving van de inhoud

# Lay-out

## Witruimte

In principe scheiden we alles in een regel met één spatie. Uitzonderingen hierop zijn:

haakjes
  ~ geen spaties voor en na een haakje ´()´, `[]` of `{}`
komma
  ~ geen spatie voor en één spatie na een komma
`:`, `::` en `:::`
  ~ geen spaties voor en na
leesbaarheid
  ~ extra spaties zijn toegelaten indien ze de leesbaarheid verhogen. Bijvoorbeeld indien hierdoor meerdere regels beter t.o.v. elkaar uitgelijnd worden.

Lange regels splits je best handmatig over meerdere regels. Hou hierbij logische dingen samen. Een voorbeeld hiervan zijn argumenten van een functie en hun waarde. Laat code die op meerdere regels staat twee spaties inspringen. Je kan RStudio instelling dat een tab automatisch naar twee spaties wordt omgezet (via `Tools`, `Global options`, `Code editing`). Laat code eveneens inspringen binnen elke blok tussen `{` en `}`. Gebruik altijd `{` en `}` ook als het niet strikt noodzakelijk is.

```{r voorbeeld_witruimte, eval = FALSE}
# Goed
lange_functie_naam <- function(
  a = "argument a", b = "waarde b"
){
  samenvoegen <- paste(a, b)
  return(samenvoegen)
}
# slecht
lange_functie_naam =function(a="argument a", b = 
"waarde b")paste(a,b)
```

## Opsplitsen van functionaliteit

We gebruiken geen ellenlange scripts. In plaats daarvan splitsen we de analyse op in zinvolle stappen. Elke stap is gedefinieerd als een afzonderlijke functie en kan op zijn beurt weer uit meerdere subfuncties bestaan. Je moet de volledige werking van een functie in een paar zinnen kunnen uitleggen.  Indien je subfuncties gebruikt, hoe je bij de uitleg van de hoofdfunctie enkel te verwijzen naar de gebruikte subfuncties zonder de werking van die subfuncties in detail uit te leggen. De uitleg van de werking van een subfunctie staat bij de subfunctie zelf.

Indien een functie uit verschillende onderdelen bestaat die niet de moeite zijn om als aparte subfuncties uit te werken, dan zet je de verschillende blokken samen in "paragrafen" die gescheiden zijn door een witregel en een regel commentaar.

Gebruik steeds de consistente volgorde van de argumenten van een functie. Gebruik steeds expliciet de naam van de argumenten wanneer het gaat om zelfgedefinieerde functies. In het geval van functies uit de standaard `R` packages hoef je de standaard argumenten niet te benoemen als dat geen negatieve invloed heeft op de leesbaarheid.

```{r, eval = FALSE}
# goed
mean(x = 1:10, na.rm = TRUE)
mean(1:10, na.rm = TRUE)
lm(HoogteM ~ OmtrekCm, data = boom)
lm(formula = HoogteM ~ OmtrekCm, data = boom)
# slecht
mean(na.rm = F, 1:10)
lm(HoogteM ~ OmtrekCm, boom)
lm(data = boom, HoogteM ~ OmtrekCm)
```

# Documentatie

## Generiek

We documenteren de generieke werking van elke functie met behulp van `roxygen`. Alle details staan beschreven in het `Roxygen2` package. De `roxygen` documentatie wordt vlak voor de bijhorende functie geplaatst. Op die manier is het eenvoudig om de documentatie bij te werken van zodra de code gewijzigd wordt.

Volgende onderdelen van de `roxygen` documentatie zijn verplicht voor elke functie:

title
  ~ de titel van de functie. Deze geeft reeds een beknopte indicatie van de werking van de functie.
decription
  ~ de volledige beschrijving van de generieke werking van de functie. Dus wat de functie doet en niet hoe de functie dat doet. Hoe iets exact werkt moet duidelijk worden in de code zelf.
param
  ~ elke argument van de functie wordt beschreven. Wat doet het argument? Welke types zijn toegelaten? Is het verplicht? Wat is de standaardwaarde?
return
  ~ welke output geeft de functie terug?
seealso
  ~ indien de hoofdfunctie gebruikt maakt van subfunctie, verwijs je hiermee naar de relevante subfuncties. Relevante subfuncties zijn de functies die nodig zijn om de globale werking van de hoofdfunctie te begrijpen.
  ~ je kan hier eveneens verwijzingen opnemen naar andere verwachte functies.
examples
  ~ een kort reproduceerbaar voorbeeld van het gebruik van de functie.
  ~ plaats code die lang duurt om uit te voeren of een foutmelding geeft in een `\dontrun{}`.

## Specifiek

Specifieke commentaar slaat op een klein stukje code of een enkele regel code. Gebruik commentaar om een blokje code van een 'titel' te voorzien.

Het is niet nodig om elke regel van commentaar te voorzien. Gebruik liever duidelijke namen voor functies, objecten en variabelen in plaats van onduidelijke namen uit te leggen aan de hand van commentaar. Code die zichzelf voldoende verklaart, hoeft geen verdere commentaar.

Het is nuttige om in de code informatie op te nemen over het waarom je een probleem op die manier opgelost hebt. Of wat de nadelen en randvoorwaarden van die oplossing zijn. 


# R Package

- NAMESPACE (import en export)
- globale variabelen --> verboden. Alternatieven: sysdata.rda en environments
- attach()
- R CMD --as-cran
- doorgeven van functieargumenten

# Documentatie

- R Package
- Taal
- Roxygen2
- examples
- vignettes
- unit tests

# Versiebeheer

- git
- forks en branches

# Referenties